# pg_service.conf generated by Ansible
{% for pg_host in pg_hosts.instances %}
  {% for databases in pg_databases.results %}
  {% if pg_host.private_ip_address == databases.item %}

#
# {{ pg_host.tags.Name }}-{{ pg_host.tags.pg_cluster }} ({{ pg_host.tags.role }})
#
    {% for db in databases.stdout_lines %}
{% if db in common_postgres_databases %}

[{{ db }}_{{ pg_host.tags.env }}_{{ pg_host.tags.pg_cluster }}{{ '_' + pg_host.tags.role if pg_host.tags.role == 'slave' else '' }}]
host={{ pg_host.private_ip_address }}
port={{ pg_port }}
dbname={{ db }}
user={{ pg_user }}
{% else %}

[{{ db }}{{ '_' + pg_host.tags.role if pg_host.tags.role == 'slave' else '' }}]
host={{ pg_host.private_ip_address }}
port={{ pg_port }}
dbname={{ db }}
user={{ pg_user }}
{% endif %}
    {% endfor %}
  {% endif %}
  {% endfor %}
{% endfor %}

# Redshift Clusters

{% for cluster in redshift_facts.results %}

[{{ cluster.cluster_identifier }}]
host={{ cluster.endpoint.address }}
port={{ cluster.endpoint.port }}
dbname={{ cluster.db_name }}
user={{ pg_user }}
{% endfor %}
